<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.dao.ReviewDao">

  <insert id="insert" parameterType="com.example.demo.dto.Review">
    <selectKey keyProperty="reviewId" resultType="Integer" order="BEFORE"> 
      select seq_reviews_review_id.nextval from dual 
    </selectKey> 
    
    insert into reviews ( review_id, post_id, request_one_id, writer_id, target_id, reviewtag_id, created_at )
    values ( #{reviewId}, #{postId}, #{requestOneId}, #{writerId}, #{targetId}, #{reviewTagId}, sysdate )
  </insert>

  <select id="selectAllByTargetId" parameterType="int" resultType="com.example.demo.dto.Review">
    select
      review_id      as reviewId,
      post_id        as postId,
      request_one_id as requestOneId,
      writer_id      as writerId,
      target_id      as targetId,
      reviewtag_id   as reviewTagId,
      created_at
    from reviews
    where target_id = #{targetId}
  </select>

  <select id="selectByReviewId" parameterType="int" resultType="com.example.demo.dto.Review">
    select
      review_id      as reviewId,
      post_id        as postId,
      request_one_id as requestOneId,
      writer_id      as writerId,
      target_id      as targetId,
      reviewtag_id   as reviewTagId,
      created_at
    from reviews
    where review_id = #{reviewId}
  </select>

  <select id="selectAllByPostId" parameterType="int" resultType="com.example.demo.dto.Review">
    select
      review_id      as reviewId,
      post_id        as postId,
      request_one_id as requestOneId,
      writer_id      as writerId,
      target_id      as targetId,
      reviewtag_id   as reviewTagId,
      created_at
    from reviews
    where post_id = #{postId}
  </select>

</mapper>