<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.dao.ReviewDao">
  <insert id="insert"
    parameterType="com.example.demo.dto.Review">
    <selectKey keyProperty="reviewId" resultType="Integer" order="BEFORE"> select
    seq_reviews_review_id.nextval from dual </selectKey> 
    insert into reviews ( review_id, post_id, request_one_id, writer_id, target_id, reviewtag_id, created_at )
    values ( #{reviewId}, #{postId}, #{requestOneId}, #{writerId}, #{targetId}, #{reviewTagId}, sysdate )
  </insert>


  <update id="update"
    parameterType="com.example.demo.dto.Review"> update reviews 
    set reviewtag_id = #{reviewTagId} 
    where review_id = #{reviewId}
  </update>

  <delete id="delete"
    parameterType="Int"> 
    delete from reviews where review_id = #{value} 
  </delete>

  <select id="selectAllByTargetId" 
          parameterType="int" 
          resultType="com.example.demo.dto.Review">
  SELECT
    review_id      AS reviewId,
    post_id        AS postId,
    request_one_id AS requestOneId,
    writer_id      AS writerId,
    target_id      AS targetId,
    reviewtag_id   AS reviewTagId,
    created_at
  FROM reviews
  WHERE target_id = #{targetId}
</select>

<select id="selectByReviewId"
        parameterType="int"
        resultType="com.example.demo.dto.Review">
  SELECT
    review_id      AS reviewId,
    post_id        AS postId,
    request_one_id AS requestOneId,
    writer_id      AS writerId,
    target_id      AS targetId,
    reviewtag_id   AS reviewTagId,
    created_at
  FROM reviews
  WHERE review_id = #{reviewId}
</select>

<select id="selectAllByPostId" 
        parameterType="int" 
        resultType="com.example.demo.dto.Review">
  SELECT
    review_id      AS reviewId,
    post_id        AS postId,
    request_one_id AS requestOneId,
    writer_id      AS writerId,
    target_id      AS targetId,
    reviewtag_id   AS reviewTagId,
    created_at
  FROM reviews
  WHERE post_id = #{postId}
</select>

</mapper>